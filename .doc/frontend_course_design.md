# 前端设计方案：课程创建与发布

## 1. 技术选型分析：关于 Vue-Flow

您提到了是否使用 `vue-flow` (基于节点的图编辑库) 来制作课程目录结构。

### 分析与建议
**我不建议使用 `vue-flow` 来做课程目录管理**，原因如下：

1.  **交互习惯不符**：`vue-flow` 适合制作“流程图”、“思维导图”或“技能树”等非线性结构。而课程目录是典型的**线性、层级化结构**（树形列表），用户习惯的操作是“上下拖拽排序”和“折叠/展开”，而不是在无限画布上拖动节点连线。
2.  **屏幕空间利用**：图表库通常需要很大的画布空间。而课程编辑通常采用 **"左侧目录树 + 右侧内容编辑"** 的布局，使用树形列表更节省空间。
3.  **开发成本**：用图表库实现“父子嵌套”和“排序”的逻辑比直接使用树形组件要复杂得多。

### 推荐方案
建议使用 **嵌套拖拽列表 (Nested Sortable List)** 或 **UI 库自带的 Tree 组件**。

*   **方案 A (推荐)**: 使用 `vuedraggable` (基于 Sortable.js)。它支持完美的嵌套拖拽，体验最流畅，符合主流 CMS 系统的操作习惯。
    *   **布局**: 类似 VS Code 的文件资源管理器。每一行是一个章节。
    *   **层级控制**: 
        *   **拖拽**: 用户可以通过拖拽节点，将其“放入”另一个节点内部成为子节点，或者拖出来成为平级节点。
        *   **缩进**: 视觉上通过 `padding-left` 体现层级。
        *   **按钮**: 每个节点右侧提供 `+` 按钮，点击后弹出菜单 "添加子章节" / "添加同级章节"。
*   **方案 B**: 使用 Element Plus / Ant Design Vue 的 `Tree` 组件。开发最快，但自定义拖拽交互可能受限。

---

## 2. 页面布局设计 (Master-Detail 模式)

采用经典的 **左右分栏** 布局：

*   **顶部 (Header)**:
    *   显示课程标题。
    *   操作按钮：“保存草稿”、“预览”、“发布课程”。
    *   状态徽章 (Draft/Published)。
*   **左侧 (Sidebar - 25%宽度)**: **章节大纲编辑器**
    *   展示树形目录。
    *   提供“添加章”、“添加节”按钮。
    *   支持拖拽排序。
    *   点击节点切换右侧视图。
*   **右侧 (Main Content - 75%宽度)**: **内容编辑器**
    *   **场景 1 (选中根节点/设置)**: 编辑课程封面、简介、价格等全局信息。
    *   **场景 2 (选中目录节点)**: 仅允许修改标题，提示“此节点为目录，不可添加内容”。
    *   **场景 3 (选中内容节点)**: 显示完整表单（标题、富文本编辑器、视频上传、附件上传）。

## 3. 组件结构拆分

```
src/views/course/
├── CourseEditor.vue          # 页面容器，负责布局和顶部状态栏
├── components/
│   ├── ChapterTree.vue       # 左侧：递归组件，处理树形展示和拖拽
│   │   └── ChapterItem.vue   # 单个节点项 (包含操作菜单：删除/重命名/添加子项)
│   ├── CourseSettings.vue    # 右侧：课程基本信息表单
│   └── ChapterEditor.vue     # 右侧：章节内容编辑器
```

## 4. 核心交互逻辑

### 4.1 状态管理 (Pinia Store)
建议创建一个 `useCourseStore`：

```javascript
state: () => ({
  courseInfo: { ... }, // 标题, 封面等
  chapters: [],        // 树形结构数据
  currentSelectedId: null, // 当前选中的章节ID (null代表选中课程设置)
  isSaving: false
})
```

### 4.2 目录与内容的互斥逻辑 (前端约束)
根据后端设计文档，前端需严格执行以下 UI 逻辑：

1.  **添加子章节时**：
    *   检查当前节点是否有 `content` 或 `video_url`。
    *   如果有，弹出 `ConfirmDialog`：“该章节已有内容，添加子章节将导致原有内容不可见/被清除，是否继续？”
    
2.  **编辑内容时**：
    *   检查当前节点是否有 `children` (子节点)。
    *   如果有，**隐藏** 视频上传和富文本编辑器，仅显示“标题”输入框，并显示提示文案：“此章节包含子章节，仅作为目录使用”。

### 4.3 视频上传
*   建议使用分片上传组件。
*   上传成功后，将返回的 URL 填入 `ChapterEditor` 的表单中。

## 5. 数据交互流程

1.  **初始化**: 进入页面 -> `GET /api/courses/:id` -> `GET /api/courses/:id/chapters` -> 组装 Store 数据。
2.  **添加章节**:
    *   用户点击“添加” -> 前端生成临时节点显示在树上 -> 用户输入标题 -> `POST /api/courses/:id/chapters` -> 后端返回真实 ID -> 更新树节点。
3.  **保存内容**:
    *   右侧表单具备“自动保存”或“失焦保存”功能，调用 `PUT` 接口更新章节详情。
4.  **发布**:
    *   点击发布 -> 校验 Store 中 `chapters` 数组是否为空 -> `PATCH /api/courses/:id/publish`。

## 6. 路由设计

```javascript
{
  path: '/course/edit/:id',
  component: () => import('../views/course/CourseEditor.vue'),
  meta: { requiresAuth: true, role: 'TEACHER' }
}
```
